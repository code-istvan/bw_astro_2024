---
import BaseLayout from '../layouts/BaseLayout.astro';
import HeroImage from '../components/HeroImage/HeroImage.astro';
import mobileImage from '../images/csapatunk_mobil.jpg';
import desktopImage from '../images/csapatunk_desktop.jpg';
import teachersData from '../data/teachers.json';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

const metadata = {
    title: 'CSAPATUNK',
    description: 'Itt találod a Bandha Works jógaoktatóit.',
};

// Összes publikált tanár lekérése és rendezése teacherOrder szerint
const teachers = await getCollection('teachers', ({ data }) => {
    return data.published === true;
}).then((teachers) => teachers.sort((a, b) => a.data.teacherOrder - b.data.teacherOrder));

// Képek importálása
const images = import.meta.glob<{ default: ImageMetadata }>('/src/images/uploads/*.{jpeg,jpg,png,gif}');

const allTeachers = await getCollection('teachers');
console.log(
    'All teachers before filter:',
    allTeachers.map((t) => ({
        name: t.data.huTeacherFullName,
        published: t.data.published,
    }))
);
---

<BaseLayout {...metadata} title={metadata.title} description={metadata.description} image={desktopImage}>
    <HeroImage mobileImgUrl={mobileImage} desktopImgUrl={desktopImage} alt={metadata.title} pageName={metadata.title} />
    <div class="container">
        <div class="row">
            {
                teachers.map((teacher) => {
                    const imagePath = teacher.data.teacherImage?.replace('src/images/', '/src/images/');
                    return (
                        <div class="col-md-6">
                            <div class="teacher-card">
                                {imagePath && (
                                    <Image
                                        src={images[`/${teacher.data.teacherImage}`]()}
                                        alt={teacher.data.huTeacherFullName}
                                        width="200"
                                        height="200"
                                        class="teacher-image"
                                    />
                                )}
                                <h2>{teacher.data.huTeacherFullName}</h2>
                                <p>{teacher.data.huTeacherTitle}</p>
                                <p>{teacher.data.huTeacherStyle}</p>
                                <a href={teacher.data.teacherLink}>Részletek</a>
                            </div>
                        </div>
                    );
                })
            }
        </div>
    </div>
</BaseLayout>

<style>
    .teacher-card {
        padding: 2rem;
        text-align: center;
        margin-bottom: 2rem;
    }

    .teacher-card img {
        max-width: 200px;
        border-radius: 50%;
        margin-bottom: 1rem;
    }

    .teacher-card h2 {
        margin-bottom: 0.5rem;
    }

    .teacher-card a {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        text-decoration: none;
        border: 1px solid currentColor;
        border-radius: 4px;
    }
</style>
