---
export const prerender = false;

import BaseLayout from '../../layouts/BaseLayout.astro';
import { turso } from '../../turso';

/* ---------------------------------
   Auth guard
---------------------------------- */
const userId = await Astro.session?.get('user-session');

if (!userId) {
  return Astro.redirect('/');
}

const { rows } = await turso.execute({
  sql: 'SELECT role FROM users WHERE id = ?',
  args: [userId],
});

if (!rows[0] || rows[0].role !== 'admin') {
  return Astro.redirect('/dashboard');
}

const user = rows[0];
---

<BaseLayout title="Admin Panel" description="Admin management panel">
  <div class="container">
    <h1>Welcome Admin!</h1>
    <p>You are logged in as: {user.role}</p>
  </div>
</BaseLayout>
